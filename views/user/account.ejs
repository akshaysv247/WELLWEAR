<!DOCTYPE html>
<html lang="en" class="darkmode" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEAR WELL FASHION STORE</title>
    <!--================= Favicon =================-->
    <link rel="apple-touch-icon" href="/images/fav.png">
    <link rel="shortcut icon" type="image/x-icon" href="/images/fav.png">
    <!--================= Bootstrap V5 CSS =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/bootstrap.min.css">
    <!--================= Font Awesome 5 CSS =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/all.min.css">
    <!--================= RT Icons CSS =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/rt-icons.css">
    <!--================= Animate css =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/animate.min.css">
    <!--================= Magnific popup Plugin =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/magnific-popup.css">
    <!--================= Swiper Slider Plugin =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/swiper-bundle.min.css">
    <!--================= Mobile Menu CSS =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/metisMenu.css">
    <!--================= Main Menu CSS =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/rtsmenu.css">
    <!--================= Preloader CSS =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/preloader.css">
    <!--================= Main Stylesheet =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/variables/variable1.css">
    <link rel="stylesheet" type="text/css" href="/Stylesheets/addressCard.css">
    <!--================= Main Stylesheet =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
        integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<%- include('partials/user-navbar2.ejs') %>

    <!-- checkout start -->
    <div class="rts-account-section section-gap">
        <div class="container">
            <div class="account-inner">
                <div class="account-side-navigation">
                    <button class="filter-btn active" data-show=".dashboard"><i class="fal fa-chart-bar"></i>
                        Dashboard</button>
                    <button class="filter-btn" data-show=".orders"><i class="fal fa-shopping-cart"></i> Orders</button>
                    <button class="filter-btn" data-show=".address"><i class="fal fa-map-marker-alt"></i>
                        Address</button>
                    <button class="filter-btn" data-show=".accountdtls"><i class="fal fa-user"></i> Account
                        Details</button>
                    <a href="/wishlist" class="filter-btn" data-show=".dashboard"><i class="fal fa-shopping-basket"></i>
                        Wishlist</a>
                    <a href="/show-coupons" class="filter-btn" data-show=".dashboard"><i
                            class="fal fa-long-arrow-right"></i>
                        Coupons</a>
                    <a href="/user-logout" class="filter-btn" data-show=".dashboard"><i
                            class="fal fa-long-arrow-left"></i>
                        Logout</a>
                </div>
                <div class="account-main-area">
                    <div class="account-main dashboard filterd-items">
                        <div class="account-profile-area">
                            <div class="profile-dp"><img src="/assets/img/user/u-xl-1.jpg" alt="profile-dp"></div>
                            <div class="d-block">
                                <span class="profile-name"><span>Hi,</span>
                                    <%= user.username %> .
                                </span>
                                <span class="profile-date d-block">
                                    <%= user.phone %>
                                </span>
                            </div>
                        </div>
                        <p>From your account dashboard you can view your recent orders, manage your shipping and billing
                            addresses, and edit your password and account details.</p>
                        <div class="activity-box">
                            <div class="activity-item">
                                <div class="icon"><i class="fas fa-box-check"></i></div>
                                <span class="title">Active Orders</span>
                                <span class="value"><%= allOrders %> </span>
                            </div>
                            <!-- <div class="activity-item">
                            <div class="icon"><i class="fas fa-download"></i></div>
                            <span class="title">Downloads</span>
                            <span class="value">10</span>
                        </div> -->
                            <div class="activity-item">
                                <div class="icon"><i class="fas fa-map-marker-alt"></i></div>
                                <span class="title">Address</span>
                                <span class="value">
                                    <%= userAddress.houseNo %> ,<%= userAddress.place %> ,<%= userAddress.state %>
                                </span>
                                <span class="value">
                                    <%= userAddress.country %>
                                </span>
                            </div>
                            <!-- <div class="activity-item">
                            <div class="icon"><i class="fas fa-user"></i></div>
                            <span class="title">Account Details</span>
                            <span class="value">33</span>
                        </div> -->
                            <div class="activity-item">
                                <div class="icon"><a href="/wishlist"><i class="fas fa-heart"></i></div>
                                <span class="title">Wishlist</span></a>
                                <span class="value">
                                    <%=user.wishlist.length %>
                                </span>
                            </div>
                            <a href="/user-logout" class="activity-item">
                                <div class="icon"><i class="fas fa-sign-out-alt"></i></div>
                                <span class="title">Logout</span>
                            </a>
                        </div>
                    </div>
                    <div class="account-main orders filterd-items hide" style="width:950px">
                        <h2 class="mb--30">My Orders</h2>
                        <table class="table">
                            <thead>
                                <tr class="top-tr">
                                    <th>Order</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Total</th>
                                    <th>Quantity</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% orders.forEach((element,index)=> { %>
                                    <tr>
                                        <td>#1910LM</td>
                                        <td>
                                            <%= element.purchaseDate.toLocaleDateString() %>
                                        </td>
                                        <td>
                                            <%= element.status %>
                                        </td>
                                        <td>
                                            <%= element.total %> 
                                        </td>
                                        <td>
                                            <%= quantityTotal[index].productsTotal %>
                                            
                                        </td>
                                        <td><a href="/order-details?id=<%= element._id %> "
                                                class="btn-small d-block">View</a></td>
                                    </tr>
                                    <% }); %>
                            </tbody>
                        </table>
                    </div>
                    <div class="account-main address filterd-items hide" style="width:950px;">
                        <div class="row">
                            <% userAddress.forEach((element,index)=> { %>


                                <div class="col-md-4 col-sm-6 content-card">
                                    <div class="card-big-shadow">
                                        <div class="card card-just-text" data-background="color" data-color="orange"
                                            data-radius="none">
                                            <div class="content" id="address-box<%= index %>">
                                                <h6 class="category">Shipping Address</h6>
                                                <h5 class="title">Name:<%= element.firstName %>
                                                        <%= element.lastName %>
                                                </h5>
                                                <address>
                                                    Name:<%= element.firstName %>
                                                        <%= element.lastName %> <br>
                                                            HouseNo:<%= element.houseNo %><br>
                                                                place:<%= element.place %> <br>
                                                                    State:<%= element.state %> <br>PIN:<%=
                                                                            element.pinCode %>
                                                                            <br>Phone:<%= element.phone %>
                                                </address>
                                                <p class="mb--10">Country:<%= element.country %>
                                                </p>
                                                <a href="/edit-address?id=<%= element._id %> "
                                                    class="btn btn-outline-primary">Edit</a>
                                                <a onclick="deleteAddress('<%= element._id %> ','<%= index %>')"
                                                    class="btn btn-outline-secondary">Delete</a>

                                            </div>
                                        </div> <!-- end card -->
                                    </div>
                                </div>
                                <% }); %>
                        </div>
                        <div><a href="/add-address"><button class="btn btn-danger">Add Address</button></a></div>
                    </div>
                    <div class="account-main accountdtls filterd-items hide" style="width:950px">
                        <div class="login-form">
                            <div class="section-title">
                                <h2>Login</h2>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <form>
                                        <div class="form">
                                            <input type="text" class="form-control" id="username"
                                                placeholder="Username or email address*" required="">
                                        </div>
                                        <div class="form">

                                            <div class="password-input">
                                                <input type="password" class="form-control" id="password"
                                                    placeholder="Password*" required="">
                                                <span class="show-password-input"></span>
                                            </div>
                                        </div>
                                        <div class="form">
                                            <input type="checkbox" class="form-check-input" id="remember">
                                            <label for="remember" class="form-label">Remember Me</label>
                                        </div>
                                        <div class="form">
                                            <button type="submit" class="btn">Login <i
                                                    class="fal fa-long-arrow-right"></i></button>
                                        </div>
                                        <a class="forgot-password" href="#">Lost your password?</a>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="offer-ad mt--40"><img src="/images/banner/45Offer.jpg" alt="ad"></div> -->
                </div>
            </div>
        </div>
    </div>

    <script>
        async function deleteAddress(addId, index) {
            $.ajax({
                url: `/delete-address?id=${addId}`,
                method: 'PATCH',
                data: {
                    addId,
                },
                success: (response) => {
                    if (response.status === true) {
                        $(`#address-box${index}`).remove()
                        const Toast = Swal.mixin({
                            toast: true,
                            psoition: 'top-end',
                            showConfirmButton: false,
                            timer: 2000,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.addEventListener('mouseenter', Swal.stopTimer);
                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                            },
                        });
                        Toast.fire({
                            icon: 'success',
                            title: 'address removed'
                        })
                    }
                    else {
                        const Toast = Swal.mixin({
                            toast: true,
                            psoition: 'top-end',
                            showConfirmButton: false,
                            timer: 2000,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.addEventListener('mouseenter', Swal.stopTimer);
                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                            },
                        });
                        Toast.fire({
                            icon: 'error',
                            title: 'oops',
                            text: 'something went wrong'
                        })
                    }
                }
            })
        }
    </script>


    <%- include('partials/user-footer.ejs') %>

        <body>
            <!--================= Preloader Section Start Here =================-->
            <!--================= Jquery latest version =================-->
            <script src="/js/vendors/jquery-3.6.0.min.js"></script>
            <!--================= Bootstrap latest version =================-->
            <script src="/js/vendors/bootstrap.min.js"></script>
            <!--================= Wow.js =================-->
            <script src="/js/vendors/wow.min.js"></script>
            <!--================= Swiper Slider =================-->
            <script src="/js/vendors/swiper-bundle.min.js"></script>
            <!--================= Nice Select =================-->
            <script src="/js/vendors/jquery.nice-select.js"></script>
            <!--================= Zoom Plugin =================-->
            <script src="/js/vendors/zoom.js"></script>
            <!--================= metisMenu Plugin =================-->
            <script src="/js/vendors/metisMenu.min.js"></script>
            <!--================= Main Menu Plugin =================-->
            <script src="/js/vendors/rtsmenu.js"></script>
            <!--================= Magnefic Popup Plugin =================-->
            <script src="/js/vendors/isotope.pkgd.min.js"></script>
            <!--================= Magnefic Popup Plugin =================-->
            <script src="/js/vendors/jquery.magnific-popup.min.js"></script>
            <!--================= Main Script =================-->
            <script src="/js/main.js"></script>
            <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        </body>
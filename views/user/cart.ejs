<!DOCTYPE html>
<html lang="en" class="darkmode" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEAR WELL FASHION STORE</title>
    <!--================= Favicon =================-->
    <link rel="apple-touch-icon" href="/images/fav.png">
    <link rel="shortcut icon" type="image/x-icon" href="/images/fav.png">
    <!--================= Bootstrap V5 CSS =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/bootstrap.min.css">
    <!--================= Font Awesome 5 CSS =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/all.min.css">
    <!--================= RT Icons CSS =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/rt-icons.css">
    <!--================= Animate css =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/animate.min.css">
    <!--================= Magnific popup Plugin =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/magnific-popup.css">
    <!--================= Swiper Slider Plugin =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/swiper-bundle.min.css">
    <!--================= Mobile Menu CSS =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/metisMenu.css">
    <!--================= Main Menu CSS =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/rtsmenu.css">
    <!--================= Preloader CSS =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/preloader.css">
    <!--================= Main Stylesheet =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/variables/variable1.css">
    <!--================= Main Stylesheet =================-->
    <link rel="stylesheet" type="text/css" href="/Stylesheets/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
        integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<%- include('partials/user-navbar2.ejs')%>
    <!--================= Cart Section Start Here =================-->
    <div class="rts-cart-section">
        <div class="container">
            <h4 class="section-title">Product List</h4>
            <div class="row justify-content-between">
                <div class="col-xl-7">
                    <div class="cart-table-area">
                        <table class="table table-bordered table-hover">
                            <thead class="thead-dark">
                            </thead>
                            <tbody>
                                <% for(let i=0;i<cartData.length;i++){ %>
                                    <tr>
                                        <td>
                                            <div class="product-thumb"><img
                                                    src="/productImages/<%= cartData[i].product.thumbnail %>"
                                                    style="height:120px;width:auto" alt="product-thumb"></div>
                                        </td>
                                        <td>
                                            <div class="product-title-area">
                                                <!-- <span class="pretitle">Nighty</span> -->
                                                <h4 class="product-title">
                                                    <%= cartData[i].product.title %>
                                                </h4>
                                            </div>
                                        </td>
                                        <td><span class="product-price">
                                                <%= cartData[i].product.price %>
                                            </span></td>
                                        <td>
                                            <div class="cart-edit">
                                                <div class="quantity-edit">
                                                    <button class="button"><i class="fal fa-minus minus"></i></button>
                                                    <input type="text" class="input"
                                                        value="<%= cartData[i].quantity %> " />
                                                    <button class="button plus">+<i
                                                            class="fal fa-plus plus"></i></button>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="last-td"><a data-id="<%= index %>"
                                                href="/delete-cart?id=<%= cartData[i]._id %>"
                                                >
                                                <button onclick="removeFromCart(this)"
                                                    class="remove-btn">Remove</button></a></td>
                                    </tr>
                                    <% } %>
                            </tbody>
                        </table>
                        <script>
                            async function removeFromCart(el) {
                                const index = $(el).data('id')
                                const res = await $.ajax({
                                    url: "/delete-cart",
                                    method: "PATCH",
                                    data: {
                                        index,
                                    },
                                });
                                if (res.status === "success") {

                                    $(el).parent("td").parent("tr").hide();
                                    $("#subtotal-price").text(`₹${res.total}`);
                                    $("#total-price").text(`₹${res.total}`);
                                } else {
                                    Swal.fire({
                                        icon: "error",
                                        title: "Oops...",
                                        text: "Something went wrong!",
                                    });
                                }
                            }
                        </script>
                        <% if(cart){ %>
                            <div class="coupon-apply">
                                <span class="coupon-text">Coupon Code:</span>
                                <div class="apply-input">
                                    <input type="text" placeholder="Apply coupon here">
                                    <button type="submit" class="apply-btn">Apply </i></button>
                                </div>
                            </div>
                            <% }else{ %>
                                <div class="coupon-apply">
                                    <P>Add some Products</P>
                                </div>
                                <% } %>
                    </div>
                </div>
                <% if(cart){ %>
                    <div class="col-xl-4">
                        <div class="checkout-box">
                            <div class="checkout-box-inner">
                                <% for(let i=0;i<cartData.length;i++){%>
                                    <div class="subtotal-area">
                                        <span class="title">Subtotal</span>
                                        <span class="subtotal-price">
                                            <%= cartData[i].total %>
                                        </span>
                                    </div>
                                    <div class="shipping-check">
                                        <span class="title">Shipping</span>
                                        <div class="check-options">
                                            <form>
                                                <div class="form-group">
                                                    <input type="checkbox" id="fltrt">
                                                    <label class="check-title" for="fltrt">Flat rate</label>
                                                </div>
                                                <div class="form-group">
                                                    <input type="checkbox" id="frsh">
                                                    <label class="check-title" for="frsh">Free shipping</label>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="shipping-location">
                                        <span class="shipping-to">Shipping to <span>NY.</span></span>
                                        <span class="change-address"><i class="fal fa-map-marker-alt mr--5"></i>Change
                                            address</span>
                                    </div>
                                    <div class="total-area">
                                        <span class="title">Total</span>
                                        <span class="total-price">
                                            <%= cart.subTotal%>
                                        </span>
                                    </div>
                                    <% } %>
                            </div>
                            <a href="/checkout" class="procced-btn">Procced To Checkout</a>

                        </div>
                    </div>
                    <% }else{ %>
                        <div class="total-area">
                            <a href="/shop" class="continue-shopping"><i class="fal fa-long-arrow-left"></i> Continue
                                Shopping</a>
                        </div>
                        <% } %>
            </div>
        </div>
    </div>

    <!--================= Cart Section End Here =================-->

    <%- include('partials/user-footer.ejs') %>

        <!--================= Jquery latest version =================-->
        <script src="/js/vendors/jquery-3.6.0.min.js"></script>
        <!--================= Bootstrap latest version =================-->
        <script src="/js/vendors/bootstrap.min.js"></script>
        <!--================= Wow.js =================-->
        <script src="/js/vendors/wow.min.js"></script>
        <!--================= Swiper Slider =================-->
        <script src="/js/vendors/swiper-bundle.min.js"></script>
        <!--================= Nice Select =================-->
        <script src="/js/vendors/jquery.nice-select.js"></script>
        <!--================= Zoom Plugin =================-->
        <script src="/js/vendors/zoom.js"></script>
        <!--================= metisMenu Plugin =================-->
        <script src="/js/vendors/metisMenu.min.js"></script>
        <!--================= Main Menu Plugin =================-->
        <script src="/js/vendors/rtsmenu.js"></script>
        <!--================= Magnefic Popup Plugin =================-->
        <script src="/js/vendors/isotope.pkgd.min.js"></script>
        <!--================= Magnefic Popup Plugin =================-->
        <script src="/js/vendors/jquery.magnific-popup.min.js"></script>
        <!--================= Main Script =================-->
        <script src="/js/main.js"></script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

        </body>